<!--index.html-->
<title>Avoids.io</title>

<body bgcolor="#CAC9C9">
	<style>
		.float_center {
		  float: right;

		  position: relative;
		  left: -50%;
		  text-align: left;
		}
		.float_center > .child {
		  position: relative;
		  left: 50%;
		}
	</style>

	<div class="float_center">
		<ul class="child">
			<div id="promptDiv" style="display:inline-block;">
				Name: <input id="promptDiv-name" type="text"></input>
				<button id="promptDiv-play">PLAY!</button>
			</div>
			<div id="gameDiv" style="display:none;">
				<canvas id="ctx" width="800" height="500" style="border:1px solid #000000; background-color: white; "></canvas>
				<div id="chat-text" style="width:800px;height:100px;overflow-y:scroll; background-color: #85C1E9; ">
				    <div>Welcome to chat!</div>
				</div>
				 
				<form id="chat-form">
				    <input id="chat-input" type="text" style="width:800px"></input>
				</form>
			</div>
		</ul>
	</div>
	 
	<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
	<script>
		//Set Up
		var chatText = document.getElementById('chat-text');
	    var chatInput = document.getElementById('chat-input');
	    var chatForm = document.getElementById('chat-form');
	    var ctx = document.getElementById("ctx").getContext("2d");
	    ctx.font = '30px Arial';

	    var socket = io();

	    var WIDTH = 800;
	    var HEIGHT = 500;

	    
	    //username setup
	    var promptDiv = document.getElementById('promptDiv')
	    var promptDivname = document.getElementById('promptDiv-name')
	    var promptDivplay = document.getElementById('promptDiv-play')

	    promptDivplay.onclick = function(){
	    	socket.emit('play',{name:promptDivname.value});
	    	promptDiv.style.display = 'none';
	    	gameDiv.style.display = 'inline-block';
	    }

	    socket.on('addToChat',function(data){
	        chatText.innerHTML += '<div>' + data + '</div>';
	    });
	    socket.on('evalAnswer',function(data){
	        console.log(data);
	    });
	   
	    chatForm.onsubmit = function(e){
	        e.preventDefault();
	        if(chatInput.value[0] === '/')
	            socket.emit('evalServer',chatInput.value.slice(1));
	        else
	            socket.emit('sendMsgToServer',chatInput.value);
	        chatInput.value = '';      
	    }

	    //game
	    socket.on('newPositions',function(data){
	        ctx.clearRect(0,0,800,500);
	        for(var i = 0 ; i < data.player.length; i++)
	        	ctx.fillStyle = data.player[i].color;
	        for(var i = 0 ; i < data.player.length; i++)
	        	ctx.fillRect(data.player[i].x,data.player[i].y,25,25);
	    });
	 
	    document.onkeydown = function(event){
	        if(event.keyCode === 68)    //d
	            socket.emit('keyPress',{inputId:'right',state:true});
	        else if(event.keyCode === 83)   //s
	            socket.emit('keyPress',{inputId:'down',state:true});
	        else if(event.keyCode === 65) //a
	            socket.emit('keyPress',{inputId:'left',state:true});
	        else if(event.keyCode === 87) // w
	            socket.emit('keyPress',{inputId:'up',state:true});
	           
	    }
	    document.onkeyup = function(event){
	        if(event.keyCode === 68)    //d
	            socket.emit('keyPress',{inputId:'right',state:false});
	        else if(event.keyCode === 83)   //s
	            socket.emit('keyPress',{inputId:'down',state:false});
	        else if(event.keyCode === 65) //a
	            socket.emit('keyPress',{inputId:'left',state:false});
	        else if(event.keyCode === 87) // w
	            socket.emit('keyPress',{inputId:'up',state:false});
	    }
	   
	</script>
</body>